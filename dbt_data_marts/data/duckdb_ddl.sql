CREATE SCHEMA IF NOT EXISTS ABTEST;
CREATE SCHEMA IF NOT EXISTS HISTORY;
CREATE TABLE IF NOT EXISTS ABTEST.AB_TEST_DASHBOARD (
    TEST_NAME VARCHAR, -- DuckDB doesn't need length for VARCHAR
    TEST_VERSION BIGINT, -- DuckDB's equivalent for NUMBER(38,0)
    TEST_STATUS VARCHAR(32),
    TEST_PERIOD VARCHAR(64),
    KPI_TYPE VARCHAR, -- DuckDB doesn't need length for VARCHAR
    KPI VARCHAR, -- DuckDB doesn't need length for VARCHAR
    BENCHMARK VARCHAR, -- DuckDB doesn't need length for VARCHAR
    METRIC VARCHAR, -- DuckDB doesn't need length for VARCHAR
    DATA_TYPE VARCHAR(10),
    DAYS_SINCE_START INTEGER, -- DuckDB's equivalent for NUMBER(10,0)
    TEST_IS_EXPOSED VARCHAR(10),
    START_DATE DATE,
    END_DATE DATE,
    GA_DATE DATE,
    CUT_TYPE VARCHAR(73),
    CUT_NAME VARCHAR(668),
    KPI_CONTROL BIGINT, -- DuckDB's equivalent for NUMBER(38,0)
    KPI_VARIANT_A BIGINT, -- DuckDB's equivalent for NUMBER(38,0)
    KPI_VARIANT_B BIGINT, -- DuckDB's equivalent for NUMBER(38,0)
    BENCHMARK_CONTROL BIGINT, -- DuckDB's equivalent for NUMBER(38,0)
    BENCHMARK_VARIANT_A BIGINT, -- DuckDB's equivalent for NUMBER(38,0)
    BENCHMARK_VARIANT_B BIGINT, -- DuckDB's equivalent for NUMBER(38,0)
    STD_ERROR_CONTROL DOUBLE, -- DuckDB's equivalent for FLOAT
    STD_ERROR_VARIANT_A DOUBLE, -- DuckDB's equivalent for FLOAT
    STD_ERROR_VARIANT_B DOUBLE, -- DuckDB's equivalent for FLOAT
    Z_SCORE_VARIANT_A DOUBLE, -- DuckDB's equivalent for FLOAT
    Z_SCORE_VARIANT_B DOUBLE, -- DuckDB's equivalent for FLOAT
    STD_ERROR_CONTROL_JACK DOUBLE, -- DuckDB's equivalent for FLOAT
    STD_ERROR_VARIANT_A_JACK DOUBLE, -- DuckDB's equivalent for FLOAT
    STD_ERROR_VARIANT_B_JACK DOUBLE, -- DuckDB's equivalent for FLOAT
    Z_SCORE_VARIANT_A_JACK DOUBLE, -- DuckDB's equivalent for FLOAT
    Z_SCORE_VARIANT_B_JACK DOUBLE, -- DuckDB's equivalent for FLOAT
    KPI_RATE_CONTROL DECIMAL(38,6),
    KPI_RATE_VARIANT_A DECIMAL(38,6),
    KPI_RATE_VARIANT_B DECIMAL(38,6),
    ONE_SIDED_P_VALUE_VARIANT_A DECIMAL(6,5),
    ONE_SIDED_P_VALUE_VARIANT_B DECIMAL(6,5),
    TWO_SIDED_P_VALUE_VARIANT_A DECIMAL(9,5),
    TWO_SIDED_P_VALUE_VARIANT_B DECIMAL(9,5),
    STAT_SIGNIFICANCE_VARIANT_A DECIMAL(10,5),
    STAT_SIGNIFICANCE_VARIANT_B DECIMAL(10,5),
    PCT_DIFF_VARIANT_A DECIMAL(38,12),
    PCT_DIFF_VARIANT_B DECIMAL(38,12),
    STD_ERROR_VARIANT_A_DIFF DOUBLE,  -- DuckDB's equivalent for FLOAT
    STD_ERROR_VARIANT_B_DIFF DOUBLE,  -- DuckDB's equivalent for FLOAT
    CI_LB_95_DIFF_VARIANT_A DOUBLE,  -- DuckDB's equivalent for FLOAT
    CI_UB_95_DIFF_VARIANT_A DOUBLE,  -- DuckDB's equivalent for FLOAT
    CI_LB_95_DIFF_VARIANT_B DOUBLE,  -- DuckDB's equivalent for FLOAT
    CI_UB_95_DIFF_VARIANT_B DOUBLE,  -- DuckDB's equivalent for FLOAT
    N DOUBLE,  -- DuckDB's equivalent for FLOAT
    DAYS_UNTIL_DATA DOUBLE,  -- DuckDB's equivalent for FLOAT
    KPI_RATE_CONTROL_JACK DECIMAL(38,12),
    KPI_RATE_VARIANT_A_JACK DECIMAL(38,12),
    KPI_RATE_VARIANT_B_JACK DECIMAL(38,12),
    ONE_SIDED_P_VALUE_VARIANT_A_JACK DECIMAL(6,5),
    ONE_SIDED_P_VALUE_VARIANT_B_JACK DECIMAL(6,5),
    TWO_SIDED_P_VALUE_VARIANT_A_JACK DECIMAL(9,5),
    TWO_SIDED_P_VALUE_VARIANT_B_JACK DECIMAL(9,5),
    STAT_SIGNIFICANCE_VARIANT_A_JACK DECIMAL(10,5),
    STAT_SIGNIFICANCE_VARIANT_B_JACK DECIMAL(10,5),
    PCT_DIFF_VARIANT_A_JACK DECIMAL(38,12),
    PCT_DIFF_VARIANT_B_JACK DECIMAL(38,12),
    STD_ERROR_VARIANT_A_DIFF_JACK DOUBLE,  -- DuckDB's equivalent for FLOAT
    STD_ERROR_VARIANT_B_DIFF_JACK DOUBLE,  -- DuckDB's equivalent for FLOAT
    CI_LB_95_DIFF_VARIANT_A_JACK DOUBLE,  -- DuckDB's equivalent for FLOAT
    CI_UB_95_DIFF_VARIANT_A_JACK DOUBLE,  -- DuckDB's equivalent for FLOAT
    CI_LB_95_DIFF_VARIANT_B_JACK DOUBLE,  -- DuckDB's equivalent for FLOAT
    CI_UB_95_DIFF_VARIANT_B_JACK DOUBLE,  -- DuckDB's equivalent for FLOAT
    N_JACK DOUBLE,  -- DuckDB's equivalent for FLOAT
    DAYS_UNTIL_DATA_JACK DOUBLE  -- DuckDB's equivalent for FLOAT
);


CREATE OR REPLACE TABLE HISTORY.AB_TEST_DIMENSION (
	NATURAL_KEY BIGINT,
	TEST_NAME VARCHAR,
	TEST_VERSION BIGINT,
	VERSION_START_DATE DATE,
	VERSION_END_DATE DATE,
	DESCRIPTION VARCHAR,
	TEST_TYPE VARCHAR,
	AUDIENCE_TYPE VARCHAR,
	PLATFORM VARCHAR,
	STATUS VARCHAR,
	RAMP BIGINT,
	ROUTE VARCHAR,
	PROJECT_NAME VARCHAR,
	RELEASE_VERSION VARCHAR,
	TEST_OWNER_NATURAL_KEY BIGINT,
	CREATED_DATE TIMESTAMP,
	MODIFIED_DATE TIMESTAMP,
	TEST_CREATED_BY_NATURAL_KEY BIGINT,
	TEST_MODIFIED_BY_NATURAL_KEY BIGINT,
	VARIATION JSON,
	TEST_METRICS VARCHAR[],
	TEST_TOUCHPOINTS VARCHAR[]
);
